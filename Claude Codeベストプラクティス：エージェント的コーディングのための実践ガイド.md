# Claude Codeベストプラクティス：エージェント的コーディングのための実践ガイド

このドキュメントは、Anthropicが提供するコマンドラインツール「Claude Code」を効果的に活用するためのベストプラクティスをまとめたものです。様々なコードベース、言語、環境で有効性が証明されたヒントやコツを紹介します。

**出典:** [Claude Code: Best practices for agentic coding](https://www.anthropic.com/engineering/claude-code-best-practices) [1]

---

## 1. セットアップのカスタマイズ

Claude Codeは、プロンプトに自動的にコンテキストを取り込むエージェント的コーディングアシスタントです。このコンテキスト収集は時間とトークンを消費しますが、環境を調整することで最適化できます。

### a. `CLAUDE.md`ファイルの作成

`CLAUDE.md`は、Claudeが対話を開始する際に自動的にコンテキストとして読み込む特別なファイルです。このファイルには、プロジェクトに関する重要な情報を記述しておくことが推奨されます。

**記述すべき内容の例:**
- 一般的なbashコマンド
- コアファイルやユーティリティ関数
- コードのスタイルガイドライン
- テストの実行手順
- リポジトリの作法（ブランチ命名規則など）
- 開発環境のセットアップ手順

`CLAUDE.md`ファイルは、リポジトリのルートやホームフォルダなど、複数の場所に配置できます。`/init`コマンドを実行すると、Claudeが自動的に`CLAUDE.md`を生成します。

### b. `CLAUDE.md`ファイルの調整

`CLAUDE.md`ファイルはClaudeのプロンプトの一部となるため、頻繁に使用するプロンプトと同様に洗練させるべきです。内容を追加するだけでなく、モデルからの指示追従性を向上させるために、「重要」や「必須」といった言葉で強調するなどの調整が有効です。

### c. 許可するツールのリストを管理

安全性を最優先するため、Claude Codeはデフォルトでファイル書き込みや多くのbashコマンドなど、システムを変更する可能性のあるアクションに対して許可を求めます。この許可リストは、安全性が確認されているツールや、元に戻すのが簡単な操作（ファイル編集、`git commit`など）を常時許可するようにカスタマイズできます。

**許可リストの管理方法:**
- セッション中にプロンプトが表示された際に「常に許可」を選択する。
- `/permissions`コマンドを使用する。
- `.claude/settings.json`または`~/.claude.json`を手動で編集する。
- `--allowedTools` CLIフラグを使用する。

### d. GitHubを使用する場合、`gh` CLIをインストール

Claudeは`gh` CLIを使用してGitHubと対話し、Issueの作成やプルリクエストのオープンなどを行います。`gh`がインストールされていない場合でも、GitHub APIやMCPサーバーを介して操作できます。

## 2. Claudeに多くのツールを与える

Claudeはシェルの環境にアクセスできるため、カスタムスクリプトや関数を利用させることができます。また、MCPやREST APIを通じてより複雑なツールも活用できます。

- **Bashツール:** `CLAUDE.md`によく使うツールを記述しておくことで、Claudeがカスタムツールを認識し、活用できるようになります。
- **MCP (Model Context Protocol):** Claude CodeはMCPサーバーとクライアントの両方として機能します。プロジェクト設定、グローバル設定、またはリポジトリ内の`.mcp.json`ファイルでMCPサーバーに接続し、そのツールを利用できます。
- **カスタムスラッシュコマンド:** `.claude/commands`フォルダにMarkdownファイルとしてプロンプトテンプレートを保存することで、繰り返し行うワークフローをカスタムコマンドとして登録できます。

## 3. 一般的なワークフロー

Claude Codeは特定のワークフローを強制しませんが、効果的な利用パターンがいくつか存在します。

### a. 調査、計画、コーディング、コミット

1.  **調査:** Claudeに関連ファイルやURLを読み込ませ、コードを書かずに情報を収集させます。複雑な問題では、サブエージェントの活用が有効です。
2.  **計画:** 問題へのアプローチ方法を計画させます。「think」「think hard」といった言葉を使うと、Claudeはより多くの思考時間をかけて代替案を検討します。
3.  **実装:** 計画に基づいてコードを実装させます。
4.  **コミット:** 結果をコミットし、プルリクエストを作成させます。

### b. テスト作成、コミット → コーディング、反復、コミット

テスト駆動開発（TDD）のアプローチです。先にテストを書かせることで、Claudeは明確な目標に向かって反復的にコードを改善できます。

1.  期待される入出力ペアに基づいてテストを書かせる。
2.  テストが失敗することを確認させる。
3.  テストをコミットする。
4.  テストが通るまでコードを修正させる。
5.  コードをコミットする。

### c. コーディング、スクリーンショット、反復

UI開発など、視覚的な目標がある場合に有効なワークフローです。

1.  ブラウザのスクリーンショットを撮る方法をClaudeに与える（Puppeteer MCPサーバーなど）。
2.  デザインモックの画像を提示する。
3.  モックと一致するまで、コード実装とスクリーンショット撮影を繰り返させる。

## 4. ワークフローの最適化

すべてのワークフローに共通する最適化のヒントです。

- **指示は具体的に:** 「foo.pyにテストを追加して」ではなく、「foo.pyに、ユーザーがログアウトしているエッジケースをカバーする新しいテストケースを書いて。モックは避けて」のように、具体的で明確な指示が成功率を大幅に向上させます。
- **画像を与える:** デザインモックや図、グラフなどの画像をコンテキストとして与えることで、特にUI開発やデバッグにおいて高いパフォーマンスを発揮します。
- **ファイルやURLに言及する:** Tabキー補完を使ってファイルやフォルダを素早く参照させたり、URLを直接貼り付けて情報を読み込ませたりできます。
- **早期に頻繁な軌道修正を行う:** 自動承諾モード（Shift+Tab）も便利ですが、アクティブな協力者としてClaudeのアプローチを導くことで、より良い結果が得られます。`Escape`キーでの中断や、`Esc`キーの2度押しによる履歴ジャンプが有効です。
- **/clearでコンテキストを集中させる:** 長いセッションでは、無関係な情報がコンテキストウィンドウを埋めてしまうことがあります。タスクの合間に`/clear`コマンドを頻繁に使い、コンテキストをリセットすることが推奨されます。

## 5. ヘッドレスモードによるインフラ自動化

Claude Codeには、CIやプリコミットフック、ビルドスクリプトなどの非対話的な環境で使用するためのヘッドレスモードが含まれています。`-p`フラグとプロンプトを組み合わせることで有効になります。

**主な用途:**
- **Issueのトリアージ:** GitHubリポジトリで新しいIssueが作成された際に、自動でラベルを付けるなどの処理を行います。
- **リンターとして:** 従来のリンターでは検出できない、タイポや古いコメント、誤解を招く関数名など、主観的なコードレビューを提供します。

## 6. マルチClaudeワークフロー

複数のClaudeインスタンスを並行して実行することで、さらに強力なワークフローを構築できます。

- **コードを書くClaudeと検証するClaudeを分ける:** 一方のClaudeがコードを書き、もう一方のClaudeがレビューやテストを行うことで、より良い結果が得られることがあります。
- **複数のリポジトリチェックアウトや`git worktree`を活用する:** 複数のタスクを同時に進めるために、別々のディレクトリでClaudeを起動し、並行して作業させることができます。
- **ヘッドレスモードとカスタムハーネス:** 大規模な移行作業や分析タスクを、スクリプトからClaudeをプログラム的に呼び出すことで自動化します。

---

### 参考文献
[1] Anthropic. (2025, April 18). *Claude Code: Best practices for agentic coding*. https://www.anthropic.com/engineering/claude-code-best-practices
